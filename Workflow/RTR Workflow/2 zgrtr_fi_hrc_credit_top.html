
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mermaid Diagram</title>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
</head>
<body>
  <div class="mermaid">
    graph TD
    START((Start Program))
    INIT[Initialize: Set up global data, check FSCM status, initialize Application Log]
    GET_FILES[/Identify and list source files to be processed into t_files/]
    FILE_LOOP{More files to process?}
    READ_FILE[/Open, read file content into t_input, and close file/]
    RECORD_LOOP{More records in t_input?}
    PARSE_RECORD[Parse current record to extract fields]
    DECIDE_PATH{Is FSCM Active?}
    PROCESS_FSCM[FSCM Path: Translate Customer to BP, determine Credit Segment, attempt update]
    PROCESS_CLASSIC[Classic Path: Attempt update on KNKK table]
    DECIDE_RESULT{Was update successful?}
    LOG_SUCCESS[Log Success: Append to t_return_s and add message to Application Log]
    LOG_FAILURE[Log Failure: Append to t_return_f and add message to Application Log]
    CHECK_ABORT{Is v_abort flag set?}
    FINALIZE_LOG[Save collected messages to Application Log SLG1]
    BUILD_ALV[Build ALV Field Catalogs for success and failure grids]
    DISPLAY_OUTPUT[/Display Success and Failure ALV Grids/]
    END((End Program))

    START --> INIT
    INIT --> GET_FILES
    GET_FILES --> FILE_LOOP
    FILE_LOOP -- Yes --> READ_FILE
    READ_FILE --> RECORD_LOOP
    RECORD_LOOP -- Yes --> PARSE_RECORD
    PARSE_RECORD --> DECIDE_PATH
    DECIDE_PATH -- Yes --> PROCESS_FSCM
    DECIDE_PATH -- No --> PROCESS_CLASSIC
    PROCESS_FSCM --> DECIDE_RESULT
    PROCESS_CLASSIC --> DECIDE_RESULT
    DECIDE_RESULT -- Yes --> LOG_SUCCESS
    DECIDE_RESULT -- No --> LOG_FAILURE
    LOG_SUCCESS --> CHECK_ABORT
    LOG_FAILURE --> CHECK_ABORT
    CHECK_ABORT -- No --> RECORD_LOOP
    RECORD_LOOP -- No --> FILE_LOOP
    CHECK_ABORT -- Yes --> FINALIZE_LOG
    FILE_LOOP -- No --> FINALIZE_LOG
    FINALIZE_LOG --> BUILD_ALV
    BUILD_ALV --> DISPLAY_OUTPUT
    DISPLAY_OUTPUT --> END
  </div>
</body>
</html>
